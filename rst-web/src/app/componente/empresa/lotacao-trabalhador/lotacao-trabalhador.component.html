<ng2-toasty></ng2-toasty>
<app-bloqueio></app-bloqueio>

<div class="titulo-pagina-intermediaria">
    <div>Raz√£o Social: {{empresa.razaoSocial}}</div>
    <div>CNPJ: {{empresa.cnpj | cnpjPipe}}</div>
</div>

<h4 class="titulo-pagina">
    {{ title }}
</h4>

<div class="container-form" *ngIf="!modoConsulta">

    <div id="allElements">
        <form class="float-label">
            <div class="row">
                <div class="form-group col-md-12">
                    <div class="md-container">
                        <md-select for="unidadeObra" [(ngModel)]="unidadeObra" name="unidadeObra" placeholder="{{'app_rst_labels_unidade_obra' | recurso}}">
                            <md-option>
                                <option value="">{{ 'app_rst_labels_selecione' | recurso }}</option>
                            </md-option>
                            <md-option *ngFor='let unidade of unidadeObraList' [value]="unidade">{{unidade.descricao}}
                            </md-option>
                        </md-select>
                    </div>
                </div>
            </div>

            <!--Grid Setor -->
            <div class="row">
                <div class="form-group col-sm-12 col-md-6">
                    <div class="borda-segmento">
                        <div id="modalLupa" #modalLupa class="input-group searchlupa">
                            <md-input-container style="border-color:transparent" [floatPlaceholder]="true">
                                <input mdInput placeholder="{{'app_rst_empresa_setor_title' | recurso }}" disabled type="text" name="setor" id="modalLupa"
                                    value="{{descricaoSiglaSetor()}}" class="form-control" appFormularioCamposErro>
                            </md-input-container>
                            <app-setor-modal *ngIf="!existeSetor()" #setorModalComponent [(setor)]="setor" [(emFiltro)]="emFiltro"></app-setor-modal>
                            <span *ngIf="existeSetor()">
                                <button type="button" class="btn btn-secondary" aria-label="Left Align" (click)='removerSetor()'>
                                    <span class="fa" [ngClass]="{'fa-times': existeSetor()}" aria-hidden="true"></span>
                                </button>
                            </span>
                        </div>
                    </div>
                </div>
                <!--Fim Grid Setor -->
                <!--Grid Cargo -->
                <div class="form-group col-sm-12 col-md-6">
                    <div class="borda-segmento">
                        <div id="modalLupa" #modalLupa class="input-group searchlupa">
                            <md-input-container style="border-color:transparent" [floatPlaceholder]="true">
                                <input mdInput placeholder="{{'app_rst_labels_cargo' | recurso }}" disabled type="text" name="cargo" id="modalLupa" value="{{descricaoCargo()}}"
                                    class="form-control" appFormularioCamposErro>
                            </md-input-container>
                            <app-cargo-modal *ngIf="!existeCargo()" #cboModalComponent [(cbo)]="cargo" [(emFiltro)]="emFiltro"></app-cargo-modal>
                            <span *ngIf="existeCargo()">
                                <button type="button" class="btn btn-secondary" aria-label="Left Align" (click)='removerCargo()'>
                                    <span class="fa" [ngClass]="{'fa-times': existeCargo()}" aria-hidden="true"></span>
                                </button>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <!--Fim Grid Cargo -->
            <!--Grid Funcao -->
            <div class="row">
                <div class="form-group col-sm-10 col-md-6">
                    <div class="borda-segmento">
                        <div id="modalLupa" #modalLupa class="input-group searchlupa">
                            <md-input-container style="border-color:transparent" [floatPlaceholder]="true">
                                <input mdInput placeholder="{{'app_rst_empresa_funcao_title' | recurso }}" disabled type="text" name="name" id="modalLupa"
                                    value="{{descricaoFuncao()}}" class="form-control" appFormularioCamposErro>
                            </md-input-container>
                            <app-funcao-modal *ngIf="!existeFuncao()" #funcaoModalComponent [(funcao)]="funcao" [(emFiltro)]="emFiltro"></app-funcao-modal>
                            <span *ngIf="existeFuncao()">
                                <button type="button" class="btn btn-secondary" aria-label="Left Align" (click)='removerFuncao()'>
                                    <span class="fa" [ngClass]="{'fa-times': existeFuncao()}" aria-hidden="true"></span>
                                </button>
                            </span>
                        </div>
                    </div>
                </div>
                <!--Fim Grid Funcao -->
                <!--Inicio Jornada -->
                <div class="form-group col-md-6">
                    <div class="md-container">
                        <md-select placeholder="Jornada" name="jornada" [(ngModel)]="jornada" id="jornada">
                            <md-option>
                                <option value=undefined>{{ 'app_rst_labels_selecione' | recurso }}</option>
                            </md-option>
                            <md-option *ngFor="let jornada of jornadas" [value]="jornada">
                                    {{ jornada.jornada.descricao + ' - ' + jornada.jornada.qtdHoras}}
                                </md-option>
                        </md-select>
                    </div>
                </div>
            </div>
            <!--Fim Jornada -->
        </form>
    </div>
</div>

<div class="btn-rodape-acoes space-up" *ngIf="!modoConsulta">
    <span>
        <button type="button" class="btn btn-primary" (click)="pesquisar();">{{ 'app_rst_btn_pesquisar' | recurso }}</button>
    </span>
</div>

<div class="container-form space-up" *ngIf="!modoConsulta && isNotEmpty(empresasLotacao)">

    <table class="table table-responsive table-hover">
        <thead>
            <tr>
                <th class="label text-center">
                    <span>{{ 'app_rst_labels_unidade_obra' | recurso }}</span>
                </th>
                <th class="label text-center">
                    <span>{{ 'app_rst_empresa_setor_title' | recurso }}</span>
                </th>
                <th class="label text-center">
                    <span>{{ 'app_rst_labels_cargo' | recurso }}</span>
                </th>
                <th class="label text-center">
                    <span>{{ 'app_rst_empresa_funcao_title' | recurso }}</span>
                </th>
                <th class="label text-center">
                    <span>Jornada</span>
                </th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let item of empresasLotacao" (click)="selecionarLotacao(item)">
                <td class="col-nome">&nbsp;{{item.unidadeObra.descricao}}</td>
                <td class="col-nome">&nbsp;{{item.empresaSetor.setor.descricao}}</td>
                <td class="col-nome">&nbsp;{{item.empresaCbo.cbo.descricao}}</td>
                <td class="col-nome">&nbsp;{{item.empresaFuncao.funcao.descricao}}</td>
                <td class="col-nome">&nbsp;{{item.empresaJornada.jornada.descricao + ' - ' + item.empresaJornada.jornada.qtdHoras}}</td>
            </tr>
        </tbody>
    </table>

    <div class="btn-paginacao" *ngIf="isNotEmpty(empresasLotacao)">
        <pagination [firstText]="paginacaoEmpresaLotacao.textPrimeiro" [lastText]="paginacaoEmpresaLotacao.textUltimo" [nextText]="paginacaoEmpresaLotacao.textProximo"
            [previousText]="paginacaoEmpresaTrabalhadorLotacao.textAnterior" [totalItems]="paginacaoEmpresaLotacao.totalItens"
            [(ngModel)]="paginacaoEmpresaLotacao.pagina" [itemsPerPage]="paginacaoEmpresaLotacao.qtdRegistro" (numPages)="paginacaoEmpresaLotacao.numPages = $event"
            (pageChanged)="pageChanged($event)" [maxSize]="paginacaoEmpresaLotacao.maxSize" class="pagination-sm justify-content-center"
            [align]="true" [boundaryLinks]="true" [rotate]="false"></pagination>
    </div>

</div>
<div *ngIf="!modoConsulta && empresaLotacaoSelecionada.valor">

    <app-associacao-trabalhador-lotacao [(dataAssociacao)]="dataAssociacao" [(dataDesligamento)]="dataDesligamento" [(model)]="empresaTrabalhadorLotacaoSelected"
        [(paginacaoEmpresaTrabalhadorLotacao)]="paginacaoEmpresaTrabalhadorLotacao" [(listaEmpresaTrabalhadorLotacao)]="listEmpresaTrabalhadorLotacao"
        [(modoConsulta)]="modoConsulta" [(empresaTrabalhador)]="empresaTrabalhador" [(empresaLotacaoSelecionada)]="empresaLotacaoSelecionada"
        [(empresaTrabalhadorLotacaoSelecionada)]="empresaTrabalhadorLotacaoSelecionada">
    </app-associacao-trabalhador-lotacao>

</div>

<br/>
<div class="container-form">
    <div class="container-subtitulo">
        <p>{{'app_rst_empresa_subtitulo_lotacao_associados' | recurso}}</p>
    </div>

    <div *ngIf="isEmpty(listEmpresaTrabalhadorLotacao)" class="row">
        <div class="form-group col-md-12">
            {{ 'app_rst_msg_nenhum_registro_adicionado' | recurso }}
        </div>
    </div>
    <div class="row grid-pesquisa" *ngIf="isNotEmpty(listEmpresaTrabalhadorLotacao)">
        <div class="col-12">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th class="text-center">{{ 'app_rst_labels_dataAssociacao' | recurso }}</th>
                        <th class="text-center">{{ 'app_rst_labels_dataDesligamento' | recurso }}</th>
                        <th class="label text-center">
                            <span>{{ 'app_rst_labels_unidade_obra' | recurso }}</span>
                        </th>
                        <th class="text-center" *ngIf="!empresaTrabalhadorLotacaoSelecionada.valor && !modoConsulta ">&nbsp;</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let item of listEmpresaTrabalhadorLotacao; let i = index">
                        <td (click)="selecionarEmpresaTrabalhadorLotacao(item, i)" class="text-center col-nao-quebra">{{item.dataAssociacao}}</td>
                        <td (click)="selecionarEmpresaTrabalhadorLotacao(item, i)" class="text-center col-nao-quebra">{{item.dataDesligamento}}</td>
                        <td (click)="selecionarEmpresaTrabalhadorLotacao(item, i)" class="text-center col-nao-quebra">{{item.empresaLotacao.unidadeObra.descricao}}</td>
                        <td class="text-center" *ngIf="!empresaTrabalhadorLotacaoSelecionada.valor && !modoConsulta">
                            <button class="btn-link" (click)="removerEmpresaTrabalhadorLotacao(item)">
                                <img class="lixo" src="assets/img/trash.svg" alt="Excluir">
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="btn-paginacao">
                <pagination [firstText]="paginacaoEmpresaTrabalhadorLotacao.textPrimeiro" [lastText]="paginacaoEmpresaTrabalhadorLotacao.textUltimo"
                    [nextText]="paginacaoEmpresaTrabalhadorLotacao.textProximo" [previousText]="paginacaoEmpresaTrabalhadorLotacao.textAnterior"
                    [totalItems]="paginacaoEmpresaTrabalhadorLotacao.totalItens" [(ngModel)]="paginacaoEmpresaTrabalhadorLotacao.pagina"
                    [itemsPerPage]="paginacaoEmpresaTrabalhadorLotacao.qtdRegistro" (numPages)="paginacaoEmpresaTrabalhadorLotacao.numPages = $event"
                    (pageChanged)="pageChangedEmpresaTrabalhadorLotacao($event)" [maxSize]="paginacaoEmpresaTrabalhadorLotacao.maxSize"
                    class="pagination-sm justify-content-center" [align]="true" [boundaryLinks]="true" [rotate]="false"></pagination>
            </div>
        </div>
        <div *ngIf="empresaTrabalhadorLotacaoSelecionada.valor">
            <app-associacao-trabalhador-lotacao *ngIf="!modoConsulta" [(dataAssociacao)]="dataAssociacao" [(dataDesligamento)]="dataDesligamento"
                [(model)]="modelEmpresaTrabalhadorLotacao" [(paginacaoEmpresaTrabalhadorLotacao)]="paginacaoEmpresaTrabalhadorLotacao"
                [(listaEmpresaTrabalhadorLotacao)]="listEmpresaTrabalhadorLotacao" [(empresaTrabalhador)]="empresaTrabalhador"
                [(empresaLotacaoSelecionada)]="empresaLotacaoSelecionada" [(empresaTrabalhadorLotacaoSelecionada)]="empresaTrabalhadorLotacaoSelecionada">
            </app-associacao-trabalhador-lotacao>
        </div>
    </div>
</div>
<div class="btn-rodape-acoes space-up">
    <button type="button" class="btn btn-secondary btn-cadastro" (click)="voltar();">{{ 'app_rst_btn_voltar' | recurso }}</button>
</div>